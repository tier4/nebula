:root {
    /* Common packages - Light Mode */
    --mermaid-common-fill: #e3f2fd;
    --mermaid-common-stroke: #1565c0;
    --mermaid-common-text: #0d47a1;

    /* Vendor packages - Light Mode */
    --mermaid-vendor-fill: #e0f2f1;
    --mermaid-vendor-stroke: #00695c;
    --mermaid-vendor-text: #004d40;

    /* Wrapper layer - Light Mode */
    --mermaid-wrapper-fill: #e3f2fd;
    --mermaid-wrapper-stroke: #1565c0;
    --mermaid-wrapper-text: #0d47a1;

    /* Logic layer - Light Mode */
    --mermaid-logic-fill: #f3e5f5;
    --mermaid-logic-stroke: #7b1fa2;
    --mermaid-logic-text: #4a148c;

    /* Worker layer - Light Mode */
    --mermaid-worker-fill: #e0f2f1;
    --mermaid-worker-stroke: #00695c;
    --mermaid-worker-text: #004d40;

    /* Subgraph strokes - Light Mode */
    --mermaid-subgraph-nebula-stroke: #666;
    --mermaid-subgraph-common-stroke: #2196f3;
    --mermaid-subgraph-vendor-stroke: #009688;

    /* Link stroke - Light Mode */
    --mermaid-link-stroke: #546e7a;

    /* Text Color - Light Mode */
    --mermaid-text-color: #000000;
}

[data-md-color-scheme="slate"] {
    /* Common packages - Dark Mode */
    --mermaid-common-fill: #0d47a1;
    --mermaid-common-stroke: #64b5f6;
    --mermaid-common-text: #e3f2fd;

    /* Vendor packages - Dark Mode */
    --mermaid-vendor-fill: #004d40;
    --mermaid-vendor-stroke: #4db6ac;
    --mermaid-vendor-text: #e0f2f1;

    /* Wrapper layer - Dark Mode */
    --mermaid-wrapper-fill: #0d47a1;
    --mermaid-wrapper-stroke: #64b5f6;
    --mermaid-wrapper-text: #e3f2fd;

    /* Logic layer - Dark Mode */
    --mermaid-logic-fill: #4a148c;
    --mermaid-logic-stroke: #e1bee7;
    --mermaid-logic-text: #f3e5f5;

    /* Worker layer - Dark Mode */
    --mermaid-worker-fill: #004d40;
    --mermaid-worker-stroke: #4db6ac;
    --mermaid-worker-text: #e0f2f1;

    /* Subgraph strokes - Dark Mode */
    --mermaid-subgraph-nebula-stroke: #bbb;
    --mermaid-subgraph-common-stroke: #64b5f6;
    --mermaid-subgraph-vendor-stroke: #4db6ac;

    /* Link stroke - Dark Mode */
    --mermaid-link-stroke: #b0bec5;

    /* Text Color - Dark Mode */
    --mermaid-text-color: #e3f2fd;
}

/* --- Nodes --- */

/* Common Nodes */
.mermaid .common rect,
.mermaid .common circle,
.mermaid .common polygon {
    fill: var(--mermaid-common-fill) !important;
    stroke: var(--mermaid-common-stroke) !important;
}

.mermaid .common text,
.mermaid .common tspan,
.mermaid .common .label,
.mermaid .common span,
.mermaid .common div {
    fill: var(--mermaid-common-text) !important;
    color: var(--mermaid-common-text) !important;
}

/* Vendor Nodes */
.mermaid .vendor rect,
.mermaid .vendor circle,
.mermaid .vendor polygon {
    fill: var(--mermaid-vendor-fill) !important;
    stroke: var(--mermaid-vendor-stroke) !important;
}

.mermaid .vendor text,
.mermaid .vendor tspan,
.mermaid .vendor .label,
.mermaid .vendor span,
.mermaid .vendor div {
    fill: var(--mermaid-vendor-text) !important;
    color: var(--mermaid-vendor-text) !important;
}

/* Wrapper Nodes */
.mermaid .wrapper rect,
.mermaid .wrapper circle,
.mermaid .wrapper polygon {
    fill: var(--mermaid-wrapper-fill) !important;
    stroke: var(--mermaid-wrapper-stroke) !important;
}

.mermaid .wrapper text,
.mermaid .wrapper tspan,
.mermaid .wrapper .label,
.mermaid .wrapper span,
.mermaid .wrapper div {
    fill: var(--mermaid-wrapper-text) !important;
    color: var(--mermaid-wrapper-text) !important;
}

/* Logic Nodes */
.mermaid .logic rect,
.mermaid .logic circle,
.mermaid .logic polygon {
    fill: var(--mermaid-logic-fill) !important;
    stroke: var(--mermaid-logic-stroke) !important;
}

.mermaid .logic text,
.mermaid .logic tspan,
.mermaid .logic .label,
.mermaid .logic span,
.mermaid .logic div {
    fill: var(--mermaid-logic-text) !important;
    color: var(--mermaid-logic-text) !important;
}

/* Worker Nodes */
.mermaid .worker rect,
.mermaid .worker circle,
.mermaid .worker polygon {
    fill: var(--mermaid-worker-fill) !important;
    stroke: var(--mermaid-worker-stroke) !important;
}

.mermaid .worker text,
.mermaid .worker tspan,
.mermaid .worker .label,
.mermaid .worker span,
.mermaid .worker div {
    fill: var(--mermaid-worker-text) !important;
    color: var(--mermaid-worker-text) !important;
}

/* --- Subgraphs --- */

/* Subgraph Borders */
.mermaid .nebula-subgraph>rect {
    fill: none !important;
    stroke: var(--mermaid-subgraph-nebula-stroke) !important;
    stroke-width: 3px !important;
}

.mermaid .common-subgraph>rect {
    fill: none !important;
    stroke: var(--mermaid-subgraph-common-stroke) !important;
    stroke-dasharray: 5 5 !important;
}

.mermaid .vendor-subgraph>rect {
    fill: none !important;
    stroke: var(--mermaid-subgraph-vendor-stroke) !important;
    stroke-dasharray: 5 5 !important;
}

/* Subgraph Titles / Cluster Labels */
.mermaid .cluster text,
.mermaid .cluster .label,
.mermaid .cluster span,
.mermaid .cluster div,
.mermaid g.cluster foreignObject div {
    fill: var(--mermaid-text-color) !important;
    color: var(--mermaid-text-color) !important;
}

/* --- Links / Edges --- */

/* Link Paths */
.mermaid .edgePath path,
.mermaid path.edgePath,
.mermaid .flowchart-link {
    stroke: var(--mermaid-link-stroke) !important;
    stroke-width: 2px !important;
    fill: none !important;
}

/* Arrowheads (Markers) */
/* Note: Mermaid often puts markers in defs, but we try to catch them here */
.mermaid marker path,
.mermaid marker circle,
.mermaid marker {
    fill: var(--mermaid-link-stroke) !important;
    stroke: var(--mermaid-link-stroke) !important;
}

/* General Text Fallback for Dark Mode */
[data-md-color-scheme="slate"] .mermaid text,
[data-md-color-scheme="slate"] .mermaid tspan,
[data-md-color-scheme="slate"] .mermaid span {
    fill: var(--mermaid-text-color) !important;
    color: var(--mermaid-text-color) !important;
}