{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Lidar Hesai parameters.",
  "type": "object",
  "definitions": {
    "sensor_model": {
      "$ref": "../../../nebula_base/nebula_ros_base/schema/hardware.json#/definitions/sensor_model",
      "enum": [
        "Pandar64",
        "Pandar40P",
        "PandarXT16",
        "PandarXT32",
        "PandarXT32M",
        "PandarQT64",
        "PandarQT128",
        "Pandar128E4X",
        "PandarAT128"
      ]
    },
    "calibration_file": {
      "$ref": "../../../nebula_base/nebula_ros_base/schema/misc.json#/definitions/calibration_file",
      "default": "$(find-pkg-share nebula_decoders)/calibration/hesai/$(var sensor_model).csv"
    },
    "calibration_download_enabled": {
      "description": "Whether to download the calibration data from the sensor and store it in `calibration_file`, or to use the file at `calibration_file` as-is. In `udp_only` and offline (`launch_hw = false`) mode, calibration from file is always used.",
      "type": "boolean",
      "default": true
    },
    "multicast_ip": {
      "$ref": "../../../nebula_base/nebula_ros_base/schema/communication.json#/definitions/multicast_ip",
      "default": "\"\""
    },
    "gnss_port": {
      "$ref": "../../../nebula_base/nebula_ros_base/schema/communication.json#/definitions/gnss_port",
      "default": "10110",
      "minimum": 0
    },
    "udp_socket_receive_buffer_size_bytes": {
      "type": "integer",
      "default": "5400000",
      "minimum": 256,
      "description": "Kernel UDP receive buffer size (SO_RCVBUF) in bytes for data socket, see `man 7 setsockopt` for details. Increase if packets are dropped due to full UDP queue. Increasing this also increases the worst case latency."
    },
    "rotation_speed": {
      "$ref": "../../../nebula_base/nebula_ros_base/schema/hardware.json#/definitions/rotation_speed",
      "default": "600",
      "minimum": 300,
      "maximum": 1200,
      "multipleOf": 60
    },
    "ptp_profile": {
      "type": "string",
      "default": "1588v2",
      "enum": [
        "1588v2",
        "802.1as",
        "automotive"
      ],
      "description": "PTP profile."
    },
    "ptp_domain": {
      "type": "integer",
      "default": "0",
      "minimum": 0,
      "maximum": 127,
      "description": "PTP domain (PTP operates within a logical scope)."
    },
    "ptp_transport_type": {
      "type": "string",
      "default": "UDP",
      "enum": [
        "UDP",
        "L2"
      ],
      "description": "1588v2 supports 'UDP' or 'L2', other profiles only L2 (HW)."
    },
    "ptp_switch_type": {
      "type": "string",
      "default": "TSN",
      "enum": [
        "TSN",
        "NON_TSN"
      ],
      "description": "For automotive profile,'TSN' or 'NON_TSN'."
    },
    "ptp_lock_threshold": {
      "type": "integer",
      "default": "100",
      "minimum": 1,
      "maximum": 100,
      "description": "The maximum sensor clock offset in microseconds from the master clock which will still be treated as being locked."
    },
    "sync_angle": {
      "type": "integer",
      "minimum": 0,
      "maximum": 359,
      "default": "0",
      "description": "The angle in whole degrees which should be hit on top-of-second."
    },
    "cut_angle": {
      "type": "number",
      "minimum": 0,
      "maximum": 360,
      "default": "0.0",
      "description": "The angle in degrees at which pointclouds are cut/published."
    },
    "hires_mode": {
      "type": "boolean",
      "description": "Whether to turn on or off the sensor's high resolution mode",
      "default": false
    },
    "blockage_mask_output": {
      "type": "object",
      "description": "Enables blockage detection and outputs a blockage mask per scan",
      "properties": {
        "horizontal_bin_size_mdeg": {
          "type": "number",
          "default": 1000,
          "minimum": 1,
          "maximum": 360000,
          "description": "The size of the horizontal bins in millidegrees"
        }
      }
    },
    "diagnostics": {
      "type": "object",
      "properties": {
        "pointcloud_publish_rate": {
          "$ref": "../../../nebula_base/nebula_ros_base/schema/diagnostics.json#/definitions/rate_bound_status"
        },
        "packet_loss": {
          "$ref": "../../../nebula_base/nebula_ros_base/schema/diagnostics.json#/definitions/packet_loss_diagnostic_task"
        },
        "functional_safety": {
          "type": "object",
          "properties": {
            "mode": {
              "type": "string",
              "enum": [
                "basic",
                "advanced"
              ],
              "default": "basic",
              "description": "Functional safety diagnostic mode"
            },
            "error_definitions_path": {
              "type": "string",
              "description": "Path to CSV file containing error definitions (required for advanced mode)"
            },
            "ignored_error_codes": {
              "type": "array",
              "items": {
                "type": "integer",
                "minimum": 0,
                "maximum": 65535
              },
              "default": [],
              "description": "List of error codes to ignore in hexadecimal format"
            }
          },
          "required": [
            "mode"
          ],
          "allOf": [
            {
              "if": {
                "properties": {
                  "mode": {
                    "const": "advanced"
                  }
                }
              },
              "then": {
                "required": [
                  "error_definitions_path"
                ]
              }
            }
          ]
        }
      }
    }
  },
  "$id": "nebula_hesai/schema/lidar_hesai.json"
}
